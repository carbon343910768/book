<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.bjtu.xxq.dao.BookDao">

    <resultMap id="bookMap" type="edu.bjtu.xxq.model.Book">
        <result column="book_id" jdbcType="INTEGER" property="bookId"/>
        <result column="book_name" jdbcType="VARCHAR" property="bookName"/>
        <result column="book_description" jdbcType="VARCHAR" property="bookDescription"/>
        <result column="book_author" jdbcType="VARCHAR" property="bookAuthor"/>
        <result column="book_publisher" jdbcType="VARCHAR" property="bookPublisher"/>
        <result column="book_published" jdbcType="DATE" property="bookPublished"/>
        <result column="book_isbn" jdbcType="VARCHAR" property="bookISBN"/>
        <result column="book_price" jdbcType="DECIMAL" property="bookPrice"/>
    </resultMap>

    <parameterMap id="bookMap" type="edu.bjtu.xxq.model.Book">
        <parameter  resultMap="bookMap" property="bookId"/>
        <parameter  resultMap="bookMap" property="bookName"/>
        <parameter  resultMap="bookMap" property="bookDescription"/>
        <parameter  resultMap="bookMap" property="bookAuthor"/>
        <parameter  resultMap="bookMap" property="bookPublisher"/>
        <parameter  resultMap="bookMap" property="bookPublished"/>
        <parameter  resultMap="bookMap" property="bookISBN"/>
        <parameter  resultMap="bookMap" property="bookPrice"/>
    </parameterMap>

    <select id="findBooksByTag" resultType="integer">
        SELECT book.book_id
        FROM book, book_tag
        WHERE book.book_id = book_tag.book_id
        AND book_tag.tag_name = #{param1}
        LIMIT #{param2}, #{param3}
        <!-- 多参数根据0,1,2赋值 -->
    </select>

    <select id="findBookById" resultMap="bookMap">
        SELECT *
        FROM book
        WHERE book_id = #{id}
    </select>

    <select id="findBooksById" resultMap="bookMap">
        SELECT *
        FROM book
        WHERE book_id IN
        <foreach collection="list" open="(" separator="," close=")" item="id">
            #{id}
        </foreach>
    </select>

    <select id="findBookImages" resultType="integer">
        SELECT image_id
        FROM book_image
        WHERE book_id = #{id} ORDER BY sequence
    </select>

    <select id="findBookTags" resultType="string">
        SELECT tag_name
        FROM book_tag
        WHERE book_id = #{id}
    </select>

    <insert id="addBook" parameterMap="bookMap">
        INSERT INTO book(book_id,book_name,book_description,book_author,book_publisher,book_published,book_isbn,book_price)
        VALUES (#{bookId},#{bookName},#{bookDescription},#{bookAuthor},#{bookPublisher},#{bookPublished},#{bookISBN},#{bookPrice})
    </insert>
    <!--
    <insert id="addBookImage">
        <selectKey keyColumn="image_id" order="AFTER" resultType="integer">
            SELECT LAST_INSERT_ID()
        </selectKey>
        INSERT INTO image(image_content) VALUES (#{image});

        INSERT INTO book_image(book_id,sequence) VALUES (#{book},1);
    </insert>
    -->
    <insert id="addBookTag" >
        INSERT INTO book_tag(book_id,tag_name) VALUES (#{book},#{tag})
    </insert>




</mapper>